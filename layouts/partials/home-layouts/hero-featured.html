{{- /*
  Hero-Featured 首页布局

  特点:
  - 全宽 Hero 特色文章
  - 特色文章网格 (6-9篇)
  - 按分类分组的文章区域
  - 现代、视觉冲击力强
  - 适合新闻网站、媒体平台

  配置:
    params.homepage.heroFeatured.featuredPostsCount (默认: 6)
    params.homepage.heroFeatured.topCategoriesCount (默认: 4)
    params.homepage.heroFeatured.postsPerCategory (默认: 3)
*/ -}}


{{- /* 获取配置参数 */ -}}
{{- $featuredPostsCount := site.Params.homepage.heroFeatured.featuredPostsCount | default 6 -}}
{{- $topCategoriesCount := site.Params.homepage.heroFeatured.topCategoriesCount | default 4 -}}
{{- $postsPerCategory := site.Params.homepage.heroFeatured.postsPerCategory | default 3 -}}

{{- /* 获取文章 */ -}}
{{- $mainSections := site.Params.mainSections | default (slice "posts") -}}
{{- $allPosts := where site.RegularPages "Type" "in" $mainSections -}}

{{- /* Hero 文章 */ -}}
{{- $heroPost := index $allPosts 0 -}}

{{- /* 特色文章(排除 Hero) */ -}}
{{- $featuredPosts := $allPosts | after 1 | first $featuredPostsCount -}}

{{- /* 收集已展示的文章 */ -}}
{{- $excludedPages := slice $heroPost | append $featuredPosts -}}

{{- /* 获取顶级分类 */ -}}
{{- $topCategories := partial "functions/get-top-categories" (dict "context" . "limit" $topCategoriesCount "minPosts" 2) -}}

<!-- Full-Width Hero -->
<section class="mb-12 md:mb-16 -mx-4 md:-mx-6 lg:-mx-8">
  {{- with $heroPost -}}
  <article class="relative group overflow-hidden">
    <a href="{{ .RelPermalink }}" class="block">
      <div class="aspect-[21/9] md:aspect-[32/9] relative overflow-hidden bg-gray-900">
        {{- $img := .Params.image | default "" -}}
        {{- if $img -}}
        <img
          src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%221%22%20height=%221%22/%3E"
          data-src="{{ $img }}"
          alt="{{ .Title }}"
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 lazyload"
          loading="eager"
        >
        {{- end -}}

        {{- /* 渐变遮罩 */ -}}
        <div class="absolute inset-0 bg-gradient-to-r from-black/90 via-black/60 to-transparent"></div>

        {{- /* 内容 */ -}}
        <div class="absolute inset-0 flex items-center">
          <div class="max-w-7xl mx-auto px-6 md:px-8 lg:px-12 w-full">
            <div class="max-w-3xl">
              {{- with index .Params.categories 0 -}}
              <span class="inline-block px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-bold uppercase tracking-wider mb-4">
                {{ . }}
              </span>
              {{- end -}}

              <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold text-white mb-4 md:mb-6 leading-tight">
                {{ .Title }}
              </h1>

              {{- with .Description -}}
              <p class="text-lg md:text-2xl text-gray-200 mb-6 line-clamp-2 md:line-clamp-3">
                {{ . }}
              </p>
              {{- end -}}

              <div class="flex items-center gap-4 text-white/90">
                {{- with .Params.author | default site.Params.author.name -}}
                <span class="font-medium">{{ . }}</span>
                <span>·</span>
                {{- end -}}
                <time datetime="{{ .Date.Format "2006-01-02" }}">
                  {{ .Date.Format "January 2, 2006" }}
                </time>
                {{- with .ReadingTime -}}
                <span>·</span>
                <span>{{ . }} 分钟阅读</span>
                {{- end -}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </a>
  </article>
  {{- end -}}
</section>

<!-- 特色文章网格 -->
<section class="mb-12 md:mb-16">
  <div class="flex items-center justify-between mb-8">
    <h2 class="text-2xl md:text-3xl font-bold">特色文章</h2>
    <a href="{{ "/posts/" | absURL }}"
       class="text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1 transition-colors">
      查看全部
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </a>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
    {{- range $featuredPosts -}}
    <article class="group bg-white rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden">
      <a href="{{ .RelPermalink }}" class="block">
        {{- /* 图片 */ -}}
        <div class="aspect-video relative overflow-hidden bg-gray-200">
          {{- $img := .Params.image | default "" -}}
          {{- if $img -}}
          <img
            src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%221%22%20height=%221%22/%3E"
            data-src="{{ $img }}"
            alt="{{ .Title }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 lazyload"
            loading="lazy"
            decoding="async"
          >
          {{- end -}}

          {{- /* 分类标签 */ -}}
          {{- with index .Params.categories 0 -}}
          <span class="absolute top-3 left-3 px-3 py-1 bg-white/95 backdrop-blur-sm rounded-full text-xs font-semibold text-gray-900 uppercase tracking-wider">
            {{ . }}
          </span>
          {{- end -}}
        </div>

        {{- /* 内容 */ -}}
        <div class="p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2 leading-snug group-hover:text-primary-600 transition-colors">
            {{ .Title }}
          </h3>

          {{- with .Description -}}
          <p class="text-gray-600 line-clamp-2 mb-4">{{ . }}</p>
          {{- end -}}

          <div class="flex items-center gap-3 text-sm text-gray-500">
            <time datetime="{{ .Date.Format "2006-01-02" }}">
              {{ .Date.Format "Jan 2" }}
            </time>
            {{- with .ReadingTime -}}
            <span>·</span>
            <span>{{ . }} min</span>
            {{- end -}}
          </div>
        </div>
      </a>
    </article>
    {{- end -}}
  </div>
</section>

<!-- 分类区域 -->
{{- range $index, $category := $topCategories -}}
<section class="mb-12 md:mb-16">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold">{{ $category.name }}</h2>
    <a href="{{ printf "/categories/%s/" ($category.name | urlize) | relURL }}"
       class="px-4 py-2 border border-gray-300 hover:border-primary-500 hover:bg-primary-50 rounded-lg text-sm font-medium transition-all">
      查看全部
    </a>
  </div>

  {{- /* 第一篇大图 + 其余小卡片 */ -}}
  {{- $categoryPosts := first $postsPerCategory $category.taxonomy.Pages -}}
  {{- $leadPost := index $categoryPosts 0 -}}
  {{- $restPosts := $categoryPosts | after 1 -}}

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    {{- /* Lead 文章 */ -}}
    {{- with $leadPost -}}
    <article class="group bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden">
      <a href="{{ .RelPermalink }}" class="block">
        <div class="aspect-video relative overflow-hidden">
          {{- $img := .Params.image | default "" -}}
          {{- if $img -}}
          <img
            src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%221%22%20height=%221%22/%3E"
            data-src="{{ $img }}"
            alt="{{ .Title }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105 lazyload"
            loading="lazy"
            decoding="async"
          >
          {{- end -}}
        </div>
        <div class="p-6">
          <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-primary-600 transition-colors">
            {{ .Title }}
          </h3>
          {{- with .Description -}}
          <p class="text-gray-600 line-clamp-2 mb-3">{{ . }}</p>
          {{- end -}}
          <time class="text-sm text-gray-500" datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "January 2, 2006" }}
          </time>
        </div>
      </a>
    </article>
    {{- end -}}

    {{- /* 其余文章 */ -}}
    <div class="space-y-4">
      {{- range $restPosts -}}
      <article class="group flex gap-4 bg-white p-4 rounded-lg hover:shadow-md transition-all">
        {{- $img := .Params.image | default "" -}}
        {{- if $img -}}
        <div class="flex-shrink-0 w-24 md:w-32">
          <a href="{{ .RelPermalink }}">
            <div class="aspect-square overflow-hidden rounded-lg">
              <img
                src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20width=%221%22%20height=%221%22/%3E"
                data-src="{{ $img }}"
                alt="{{ .Title }}"
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 lazyload"
                loading="lazy"
                decoding="async"
              >
            </div>
          </a>
        </div>
        {{- end -}}

        <div class="flex-1 min-w-0">
          <h3 class="text-base font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-primary-600 transition-colors">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h3>
          <time class="text-xs text-gray-500" datetime="{{ .Date.Format "2006-01-02" }}">
            {{ .Date.Format "January 2, 2006" }}
          </time>
        </div>
      </article>
      {{- end -}}
    </div>
  </div>
</section>

{{- if lt $index (sub (len $topCategories) 1) -}}
<hr class="my-8 md:my-12">
{{- end -}}

{{- end -}}

<!-- 订阅部分 -->
{{- partial "content/newsletter.html" . -}}

